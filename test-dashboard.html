<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ChurnGuard Dashboard - FitnessMaster Pro</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      max-width: 800px; 
      margin: 50px auto; 
      padding: 20px; 
      background-color: #1f2937; /* gray-800 */
      color: #e5e7eb; /* gray-200 */
    }
    .grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
      gap: 20px; 
      margin: 20px 0; 
    }
    .card { 
      background: #374151; /* gray-700 */
      padding: 20px; 
      border-radius: 8px; 
      text-align: center; 
      border-left: 4px solid; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: box-shadow 0.3s;
    }
    .card:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
    .blue { border-color: #3b82f6; } /* blue-500 */
    .blue .number { color: #60a5fa; } /* blue-400 */
    .green { border-color: #22c55e; } /* green-500 */
    .green .number { color: #4ade80; } /* green-400 */
    .yellow { border-color: #eab308; } /* yellow-500 */
    .yellow .number { color: #fde047; } /* yellow-400 */
    .red { border-color: #ef4444; } /* red-500 */
    .red .number { color: #f87171; } /* red-400 */
    .section { margin: 30px 0; }
    .section h3 { color: #d1d5db; border-bottom: 2px solid; padding-bottom: 10px; margin-bottom: 15px; }
    .item { 
      background: #374151; /* gray-700 */
      padding: 15px; 
      border-radius: 8px; 
      margin: 10px 0; 
      border-left: 4px solid; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: background 0.3s;
    }
    .item:hover { background: #4b5563; /* gray-600 */ }
    .demo { 
      background: #1f2937; /* gray-800 */
      padding: 20px; 
      border-radius: 8px; 
      margin: 30px 0; 
      border: 1px solid #3b82f6; /* blue-500 */
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    .demo h4 { margin: 0 0 10px 0; color: #60a5fa; /* blue-400 */ }
    #loading { text-align: center; color: #9ca3af; /* gray-400 */ }
    #error { color: #ef4444; /* red-500 */ background: #991b1b; /* red-800 */ padding: 10px; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>ðŸš€ ChurnGuard Dashboard - FitnessMaster Pro</h1>
  
  <div id="loading">Loading dashboard data...</div>
  <div id="error" style="display: none;"></div>
  
  <div id="dashboard" style="display: none;">
    <!-- Stats Grid -->
    <div class="grid">
      <div class="card blue">
        <div class="number" id="total">0</div>
        <div>Total Members</div>
      </div>
      <div class="card green">
        <div class="number" id="active">0</div>
        <div>Active Members</div>
      </div>
      <div class="card yellow">
        <div class="number" id="atRisk">0</div>
        <div>At Risk</div>
      </div>
      <div class="card red">
        <div class="number" id="churned">0</div>
        <div>Churned</div>
      </div>
    </div>

    <!-- At-Risk Members -->
    <div class="section">
      <h3 style="border-color: #eab308;">ðŸš¨ At-Risk Members</h3>
      <div id="atRiskMembers"></div>
    </div>

    <!-- Recent Cancellations -->
    <div class="section">
      <h3 style="border-color: #ef4444;">ðŸ“‹ Recent Cancellations</h3>
      <div id="recentCancellations"></div>
    </div>

    <!-- Survey Results -->
    <div class="section">
      <h3 style="border-color: #3b82f6;">ðŸ“Š Exit Survey Results</h3>
      <div id="surveyReasons"></div>
    </div>

    <!-- Demo Info -->
    <div class="demo">
      <h4>ðŸŽ­ Demo Scenario</h4>
      <p>This is FitnessMaster Pro, owned by Sarah Johnson. She has 7 members with a 43% churn rate. ChurnGuard is helping her identify at-risk members and collect feedback from those who leave.</p>
    </div>
  </div>

  <script>
    async function loadDashboard() {
      try {
        const response = await fetch('http://localhost:3001/api/dashboard?businessId=fitness_pro_123');
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        
        // Update stats
        document.getElementById('total').textContent = data.total;
        document.getElementById('active').textContent = data.active;
        document.getElementById('atRisk').textContent = data.atRisk;
        document.getElementById('churned').textContent = data.churned;
        
        // Update at-risk members
        const atRiskDiv = document.getElementById('atRiskMembers');
        atRiskDiv.innerHTML = '';
        if (data.atRiskMembers.length > 0) {
          data.atRiskMembers.forEach(member => {
            const div = document.createElement('div');
            div.className = 'item';
            div.style.borderColor = '#eab308'; // yellow-500
            div.innerHTML = `
              <strong>${member.name || 'Unknown'}</strong> (${member.email || 'No email'})<br>
              <small>Risk: ${member.riskReason || 'Unknown'}</small>
            `;
            atRiskDiv.appendChild(div);
          });
        } else {
          atRiskDiv.innerHTML = '<p>No at-risk members</p>';
        }
        
        // Update recent cancellations
        const recentDiv = document.getElementById('recentCancellations');
        recentDiv.innerHTML = '';
        if (data.recentCancellations.length > 0) {
          data.recentCancellations.forEach(cancel => {
            const div = document.createElement('div');
            div.className = 'item';
            div.style.borderColor = '#ef4444'; // red-500
            div.innerHTML = `
              <strong>${cancel.name || 'Unknown'}</strong> (${cancel.email || 'No email'})<br>
              <small>Reason: ${cancel.exitSurveyReason || 'No reason provided'}</small>
            `;
            recentDiv.appendChild(div);
          });
        } else {
          recentDiv.innerHTML = '<p>No recent cancellations</p>';
        }
        
        // Update survey reasons
        const surveyDiv = document.getElementById('surveyReasons');
        surveyDiv.innerHTML = '';
        if (data.surveyReasons.length > 0) {
          data.surveyReasons.forEach(reason => {
            const div = document.createElement('div');
            div.className = 'item';
            div.style.borderColor = '#3b82f6'; // blue-500
            div.innerHTML = `
              <strong>${reason.exitSurveyReason}</strong> (${reason._count} member${reason._count > 1 ? 's' : ''})
            `;
            surveyDiv.appendChild(div);
          });
        } else {
          surveyDiv.innerHTML = '<p>No survey responses yet</p>';
        }
        
        document.getElementById('loading').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
      } catch (error) {
        console.error('Error loading dashboard:', error);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').style.display = 'block';
        document.getElementById('error').textContent = `Error: ${error.message}`;
      }
    }

    loadDashboard();
  </script>
</body>
</html>
